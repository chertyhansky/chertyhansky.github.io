+++
author = "Akaky Chertyhansky"
title = 'Notion'
date = 2024-11-16T17:30:15+05:00
description = "Notion window manager"
tags = [
    "linux",
    "notion",
]
categories = [
    "linux",
]
+++

## Содержание:

1. [Введение](#intro)
2. [Особенности notion](#features)
3. [Установка](#install)
4. [Запуск](#start)
5. [Сочетания клавиш](#bindings)
    - [Базовые сочетания](#basic)
    - [Workspaces & frames](#workspaces)
6. [Заключение](#conclusion)
7. [Ссылки](#links)

## <a id='intro'></a>Введение

Notion - это не тот, что сейчас у всех на слуху. Это tiling tabbed window manager, почему-то незаслуженно малопопулярный.

Когда-то был ion3. Но его разработчик Tuomo Valkoonen в один прекрасный момент его забросил, покрыл матом всё opensource community и свалил на винду (немного эксцентричный товарищ, да).

Notion - форк ion3. Полностью совместим с ion3, т.е. всё, что работало в ion3, точно так же работает и здесь. Когда-то по ion3 было много статей, но сейчас они все канули в небытие, посему постараюсь объять необъятное. Некоторое найденное будет в [ссылках](#links) в конце.

## <a id='features'></a>Особенности notion

Notion - tabbed tiling wm. Причём tiling - статический. Сейчас объясню что это и как.

В нём нет привычных окон, которые могут быть произвольного размера, накладываться друг на друга, образовывать нагромождения и хаос.

Notion состоит из фреймов. Каждое открытое окно занимает весь фрейм. Экран можно поделить на несколько фреймов как душе угодно, фреймам можно дать имена, приложениям можно дать правила какое из них в каком фрейме будет запускаться - и будет полная идиллия. Такой подход мне нравится сильно больше, чем wmii/awesome, где каждое новое приложение пытается подвинуть остальные и занять себе место на экране.

В одном фрейме можно запустить несколько приложений. Тогда они сделаются вкладками внутри одного фрейма. Вот поэтому он tiling tabbed wm.

Помимо обычных фреймов имеются плавающие, в терминологии notion - scratchpads. Scratchpad может быть произвольного размера и располагаться в произвольном месте экрана. Отличие от просто плавающего окна в том, что его можно показать/спрятать по хоткею. Например, у меня в них находятся мессенджеры: нажал хоткей, написал сообщение, нажал ещё раз - и готово. Положение его на экране запоминается. Самих scratchpads может быть сколько угодно.

Имеются и традиционные уже для всех *nix-овых wm десктопы. На каждом из них можно создать свою конфигурацию фреймов, к фреймам или десктопам можно привязать свои приложения. Внутри скрэтчпада тоже можно создать нескольо фреймов, но это не очень удобно.

Статусбар тоже в наличии. Есть возможность убрать в него systray (сам трей реализован сторонней утилитой, в моём случае stalonetray, но есть и другие. Ещё есть docker. Изначально он предназначался для апплетов WindowMaker, насколько я понял. У меня в нём живёт conky.

Ну и для дополнительных возможностей есть плагины. Плагины, как и конфигурационные файлы, написаны на lua. Плагины позволяют, например, спрятать tabbar, если во фрейме всего одна вкладка; вывести информацию в статусбар (громкость, скорость интернет-соединения, заряд батареи, проигрываемый трек в mpd, и т.п.).

## <a id='install'></a>Установка

Notion присутствует в репозиториях большинства дистрибутивов. Поэтому `sudo pacman -S notion`, `sudo aptitude install notion` или `sudo emerge notion`, в зависимости от религии.

Здесь есть нюанс. Если планируется использовать dock (например, как у меня - засунуть туда conky), то в стандартной сборке ширина этого самого дока 64 пикселя. Это захардкодено и не настраивается, но у нас тут опенсоурс: идём на [github](https://github.com/raboof/notion/), скачиваем исходники, в файле mod_dock/dock.c находим строки (начало в районе 281):

```c
static const WDockParam dock_param_tile_width={
    "width",
    "tile width",
    NULL,
    64
};

static const WDockParam dock_param_tile_height={
    "height",
    "tile height",
    NULL,
    64
};
```
Как понятно из кода, это соответственно ширина вертикального дока или высота горизонтального. 64 можно изменить на своё значение (у меня, например, 420), и далее - `make && make install`, либо собрать пакет для своего дистрибутива, если по феншую.

Далее остаётся добавить в `~/.xinitrc` строчку `notion` вместо того, что там сейчас - и готово.

## <a id='start'></a>Запуск

При первом запуске мы увидим поделённый на два фрейма десктоп, статусбар и, возможно, какое-то приветственное сообщение со шпаргалкой по дефолтным хоткеям.

![Первый запуск](/images/03-notion/01.png)

Обычно это вводит в ступор, но мы не такие. Попробуем разобраться что дальше.

На сайте есть [шпаргалка](https://notionwm.net/tour.html). Мои хоткеи ооочень отличаются от дефолтных, и писал я их настолько давно, что дефолтных уже и не помню. Переведу часть из шпаргалки, заодно прокомментирую немного от себя.

Для начала немного вводной информации. Большинство хоткеев используют клавишу, называемую META.
Так она названа в конфигах, так же будем называть её и тут, воизбежание путаницы.
По умолчанию `META = "Mod4+"` (цитата из cfg_notion.lua). Mod4 - это клавиша с кривым окошком, она же winkey.
Также есть `ALTMETA = "Mod4+Shift"` (уже отличие - у меня `ALTMETA="Mod1+"`, т.е. <key>Alt</key>).

А сочетания клавиш будем указывать в виде `META..T` или `META..Control+K`.
Именно в таком виде они записаны в конфигурационных файлах (не совсем - я пропустил несколько кавычек для наглядности).
Две точки - символ конкатенации строк в lua, соответственно `META.."T"` превратится в `"Mod4+T"`.
Есть ещё вариант `META..K, Tab` - это означает, что надо нажать `META..K`, а потом `Tab`.
Кавычки здесь буду пропускать, но в конфиге они нужны, без них lua не поймёт.
В конфиги мы полезем позже, но привыкать будем заранее :)

Ну и приложение, запущенное во фрейме, табе, скрэтчпаде или где-либо ещё, будем называть клиентом.

Начнём.

## <a id='bindings'></a>Сочетания клавиш

### <a id='basic'></a>Базовые

- `META..F1` - Notion man page;
- `META..N`, `META.."P"` - фокус вниз/вверх;
- `META..Tab`, `META..K, Tab` - фокус вправо/влево;
- `F2` - запускает терминал (по умолчанию - xterm);
- `F3` - запуск программ - можно написать в строке команду (автодополнение имеется) и нажать <key>Enter</key>.

Тут мы впервые видим mod_query. Через него здесь устроен запуск программ, меню, выполнение кода на lua, и в принципе можно придумать любое применение.

![mod_query](/images/03-notion/mod_query.png)

А теперь немного пошалим. Изначально у нас было два фрейма, теперь мы можем запускать программы. Запустим парочку терминалов в одном и том же фрейме - и мы увидим табы.

![Табы](/images/03-notion/02.png)

- `META..K, N`, `META..K, P` - переключение между табами.

Можно увидеть, что при нажатии `META..K` на табах появляются цифры:

![Табы](/images/03-notion/03.png)

- `META..K, <цифра>` - переключиться на соответствующий таб;

- `META..T` - пометить клиент (в оригинале "tag a client");
- `META..K, A` - переместить клиент в текущий фрейм (в оригинале "attach tagged").

Здесь нужно пояснение. Допустим, мы хотим перенести клиент "2" из правого фрейма в левый.

![Tagged](/images/03-notion/04.png)

Так выглядит ситуация после нажатия `META..T`, находясь в первом табе правого фрейма.
Тут мы тэгнули клиент.
Далее мы можем перейти в левый фрейм и нажать там `META..K, A` - клиент "2" переместится в левый фрейм.

Есть и другой способ сделать это же:
- `META..A` - перенести клиент в текущий фрейм. Уже знакомый mod_query, сюда нужно вписать то, что мы видим в заголовке окна, а можно просто нажать <key>Tab</key> и выбрать из списка.

### <a id="workspaces"></a>Workspaces & frames

В notion workspaces - это то, что в других wm называется "виртуальными рабочими столами".

- `META..F9` - создать новый вокрспейс;
- `META..1`, `META..2` и т.д. - переключиться на 1, 2 и т.д. вокрспейс;
- `META..comma, META..period  - предыдущий/следующий вокрспейс (comma & period - соответственно, запятая и точка).

Соответственно, окна между воркспейсами можно перемещать точно так же, как и между фреймами на одном воркспейсе.

- `META..S` - разделить текущий фрейм на два по вертикали;
- `META..K, S` - то же по горизонтали;
- `META..K, X` - разрушить сплит (если во фреймах есть клиенты, они станут табами в одном фрейме);

Теперь мы можем создавать структуры фреймов. Например, такое:

![layout](/images/03-notion/05.png)

Не очень практично, но можем!

- `META..R` - режим изменения размера фрейма:
    - `курсор` - увеличить фрейм в заданном направлении;
    - `Shift+курсор` - уменьшить фрейм в заданном направлении;
    - `Esc` - отменить;
    - `Return` - подтвердить.

- `F12` - главное меню, тоже mod_query с автодополнением. Из полезного сейчас: 
    - `session/save` - сохранить сессию (имеется в виду воркспейсы и фреймы);
    - `session/exit` - выход;
    - `session/restart` - перезапустить notion (пригодится, когда будем редактировать конфиги).
exit и restart по умолчанию тоже сохраняют сессию.

- `META..Return` - развернуть клиент на весь экран и вернуть на место (клиент на самом деле становится новым воркспейсом, соответственно на него можно переключаться как на другой воркспейс);
- `META..K, H`, `META..K, V` - развернуть фрейм на максимальную ширину/высоту или вернуть растянутому прежний размер.

Это далеко не всё, но объять все сочетания в одной статье - невозможно, да и большая их часть будет переназначена в процессе. Я не затронул, например, context menu, до которого можно добраться не помню каким дефолтным сочетанием, и правой кнопкой мыши по заголовку фрейма. Причём в первом случае это будет mod_query, а во втором - mod_menu, обычное меню для тыкания мышью. А все сочетания можно посмотреть в /etc/notion/*.lua (или /usr/local/etc/notion/*.lua, если установлено из исходников).


## <a id="conclusion"></a>Заключение

Надеюсь, из вышесказанного понятно, что WM более чем заслуживает внимания. Лично мне его возможностей хватает для всего, что требуется. 

Если почитать статьи 10-15-летней давности, можно заметить, что принципиально ничего и не изменилось, да и сейчас разработка не бурлит и не кипит, в github тихо, новых версий не выходит. Возможно, кто-то посчитает проект мёртвым, но я бы сказал, он настолько совершенен, что в доработках не нуждается.

В следующей статье рассмотрим процесс настройки. В частности, дефолтные сочетания мне не нравятся категорически - для перемещения фокуса между фреймами у меня `META..<H,J,K,L>`, между табами - `META..<I,O>`, resize mode тоже через hjkl, и т.д..
А пока можно почитать то, что есть ниже по ссылкам.

## <a id="links"></a>Ссылки

1. [Notion](https://notionwm.net/)
2. [Notion on github](https://github.com/raboof/notion/)
3. [A guided Tour through Notion](https://notionwm.net/tour.html)
4. [Обзор оконного менеджера Ion3](https://www.opennet.ru/docs/RUS/ion3/)
5. [Configuring and extending Notion with Lua](https://raboof.github.io/notion-doc/notionconf/)
6. [Notion keyboard reference](https://notionwm.net/notionkeys.html)
